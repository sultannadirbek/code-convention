<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тестирование и Покрытие | Манифест PHP Mechta.kz</title>
    <link rel="icon" href="favicon.png" type="image/x-icon">
    <link href="./styles/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="./styles/main.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap&subset=cyrillic"
          rel="stylesheet">
</head>
<body>
<div class="container py-5">
    <svg viewBox="0 0 114 17" xmlns="http://www.w3.org/2000/svg"
         class="inline-block q-mb-lg vertical-middle fill-primary tw-h-8 tw-w-[209px]">
        <path d="M8.712 0a8.867 8.867 0 0 0-4.84 1.432A8.549 8.549 0 0 0 .665 5.245a8.308 8.308 0 0 0-.497 4.91 8.438 8.438 0 0 0 2.38 4.352 8.781 8.781 0 0 0 4.459 2.328c1.689.33 3.44.163 5.032-.479a8.67 8.67 0 0 0 3.912-3.126 8.355 8.355 0 0 0 .821-7.98 8.462 8.462 0 0 0-1.887-2.765A8.703 8.703 0 0 0 12.053.641 8.873 8.873 0 0 0 8.712 0Zm0 15.246a7.04 7.04 0 0 1-3.844-1.138 6.788 6.788 0 0 1-2.548-3.03 6.597 6.597 0 0 1-.392-3.902 6.7 6.7 0 0 1 1.897-3.455A6.973 6.973 0 0 1 7.37 1.876a7.078 7.078 0 0 1 3.997.39 6.882 6.882 0 0 1 3.102 2.49 6.632 6.632 0 0 1 1.16 3.753 6.685 6.685 0 0 1-2.035 4.76 7.023 7.023 0 0 1-4.882 1.977Z"></path>
        <path d="M6.464 4.968 12.697 7.9a.676.676 0 0 1 .286.245.652.652 0 0 1 0 .713.676.676 0 0 1-.286.245l-6.233 2.93a.693.693 0 0 1-.65-.044.65.65 0 0 1-.312-.557V5.57a.65.65 0 0 1 .313-.557.69.69 0 0 1 .649-.044Zm21.934 5.445a130.49 130.49 0 0 0-4.075-8.75h-3.741v13.675h2.64V5.156c.79 1.628 2.087 4.604 3.888 8.927h2.14c1.559-3.59 2.89-6.573 4.033-8.927v10.182h2.682V1.662h-3.553c-1.56 3.022-2.898 5.939-4.014 8.751Zm13.83-5.237c-3.26 0-4.927 1.294-4.927 5.12 0 1.942.437 3.213 1.33 4.017.893.804 2.162 1.197 3.805 1.197a15.277 15.277 0 0 0 3.995-.55l-.416-1.923a13.835 13.835 0 0 1-3.267.412c-.977 0-1.68-.176-2.1-.51-.416-.353-.623-.937-.644-1.957h6.901c.083-2.41-.207-3.806-1.04-4.668-.81-.863-1.87-1.138-3.637-1.138Zm-2.206 3.942c.142-1.542.706-2.024 2.307-2.024.769 0 1.285.136 1.56.431.269.275.442.832.477 1.588l-4.344.005Zm13.501-1.823a7.19 7.19 0 0 1 2.453.432l.582-2.08c-.89-.314-1.977-.471-3.223-.471-1.725 0-3.015.392-3.908 1.177-.89.766-1.33 2-1.33 3.943 0 1.941.437 3.213 1.33 4.017.893.804 2.183 1.197 3.908 1.197 1.247 0 2.328-.177 3.223-.51l-.582-2.08a6.803 6.803 0 0 1-2.453.47c-.998 0-1.705-.216-2.141-.627-.415-.432-.624-1.173-.624-2.428.104-2.766.79-3.04 2.765-3.04ZM65.45 5.529c-.52-.236-1.205-.353-2.1-.353a6.654 6.654 0 0 0-2.91.686v-4.69h-2.577v14.166h2.578V8.256c0-.55.89-.883 2.037-.883 1.497 0 2.12.51 2.12 2.531v5.434h2.579v-5.63c-.001-2.433-.666-3.73-1.727-4.18Zm8.565 7.881c-1.143 0-1.6-.568-1.6-1.745V7.47h3.512V5.349h-3.514V2.663l-2.577 1.001v1.687h-1.767v2.121h1.767v4.41c0 1.413.27 2.374.831 2.884.561.491 1.456.746 2.703.746a9.193 9.193 0 0 0 2.91-.452l-.458-1.922a6.42 6.42 0 0 1-1.807.273Zm12.405 1.418c-1.549.463-3.16.693-4.781.682-1.68 0-2.866-.236-3.513-.687-.644-.47-.957-1.253-.957-2.546 0-1.314.333-2.178 1.02-2.61.685-.451 1.745-.667 3.139-.667a14.2 14.2 0 0 1 2.618.274c0-.883-.166-1.35-.494-1.627-.332-.294-1.04-.432-2.141-.432a9.823 9.823 0 0 0-3.202.49l-.478-2a17.403 17.403 0 0 1 4.22-.53c1.622 0 2.786.294 3.493.868.727.566 1.077 1.565 1.077 3.02v5.765Zm-2.47-3.905a10.804 10.804 0 0 0-2.1-.176c-1.559 0-1.976.193-1.976 1.432 0 .668.125.996.375 1.193.249.177.768.275 1.58.275a8.614 8.614 0 0 0 2.121-.23v-2.494Zm8.192 2.983c0 1.295-.382 1.53-1.608 1.53-1.166 0-1.549-.235-1.549-1.53 0-1.196.383-1.374 1.549-1.374 1.227.002 1.608.178 1.608 1.374Zm8.93 1.432c-2.313-3.278-3.72-5.042-4.284-5.278v5.278h-2.494V1.172h2.494v8.888c.563-.451 1.95-2.06 3.961-4.709h2.956c-1.97 2.59-3.379 4.121-3.921 4.532.523.314 2.051 2.138 4.223 5.455h-2.935ZM114 5.351v.491c-1.448 2.276-3.921 5.71-5.269 7.378h5.128v2.12h-9.029v-.492c1.95-2.41 4.348-5.768 5.349-7.377h-5.007V5.349l8.828.002Z"></path>
    </svg>

    <h1 class="text-center mb-5">Тестирование и Покрытие</h1>

    <div class="card">
        <div class="card-body">
            <div class="container py-5">
                <h1 class="mb-4">Тестирование и Покрытие</h1>

                <p>Тестирование — это важнейший элемент разработки, который помогает проверить правильность работы
                    системы и убедиться в корректном выполнении бизнес-логики. В данном подходе используется PHPUnit для
                    изоляции доменных сервисов с учётом интерфейсов репозиториев, что соответствует принципам чистой
                    архитектуры.</p>

                <h2>1. Организация тестов в чистой архитектуре</h2>
                <p>В нашем подходе доменный сервис имеет доступ только к интерфейсу репозитория, а не к конкретной
                    реализации. Тестирование должно покрывать как положительные, так и отрицательные сценарии, проверяя
                    возможные ошибки в бизнес-логике и работоспособность системы в нештатных ситуациях.</p>

                <h2>2. Пример юнит-теста с использованием интерфейса репозитория</h2>
                <p>Рассмотрим пример теста для доменного сервиса <code>OrderService</code>, который взаимодействует с
                    репозиторием заказов через интерфейс <code>OrderRepositoryInterface</code>. В тестах будем
                    использовать моки для изоляции внешних зависимостей.</p>

                <h3>Тестирование создания заказа</h3>
                <pre><code>
use PHPUnit\Framework\TestCase;

class OrderServiceTest extends TestCase
{
    private $orderService;
    private $orderRepositoryMock;

    protected function setUp(): void
    {
        // Создаём мок для интерфейса репозитория
        $this->orderRepositoryMock = $this->createMock(OrderRepositoryInterface::class);

        // Создаём экземпляр сервиса с зависимостью от интерфейса репозитория
        $this->orderService = new OrderService($this->orderRepositoryMock);
    }

    public function testCreateOrderSuccess()
    {
        // Мокируем метод сохранения заказа, чтобы он возвращал успешный результат
        $this->orderRepositoryMock
            ->expects($this->once())
            ->method('save')
            ->willReturn(true);

        // Входные данные для создания заказа
        $request = new CreateOrderRequest(1, [101], '123 Main St');

        // Выполняем сценарий
        $response = $this->orderService->createOrder($request);

        // Проверяем успешное создание заказа
        $this->assertTrue($response->success);
        $this->assertEquals('Заказ успешно создан', $response->message);
    }

    public function testCreateOrderFailsWhenOrderNotSaved()
    {
        // Мокируем метод сохранения, чтобы он вернул false (ошибка сохранения)
        $this->orderRepositoryMock
            ->expects($this->once())
            ->method('save')
            ->willReturn(false);

        // Входные данные для создания заказа
        $request = new CreateOrderRequest(1, [101], '123 Main St');

        // Выполняем сценарий
        $response = $this->orderService->createOrder($request);

        // Проверяем, что создание заказа провалилось
        $this->assertFalse($response->success);
        $this->assertEquals('Ошибка при создании заказа', $response->message);
    }
}
    </code></pre>

                <h3>Объяснение теста:</h3>
                <ul>
                    <li><strong>Интерфейс репозитория:</strong> Вместо того чтобы использовать конкретную реализацию
                        репозитория, мы взаимодействуем с интерфейсом <code>OrderRepositoryInterface</code>, что
                        соответствует принципам чистой архитектуры.
                    </li>
                    <li><strong>Мокирование:</strong> Мы создаём мок репозитория, чтобы протестировать бизнес-логику в
                        изоляции от реальной базы данных.
                    </li>
                    <li><strong>testCreateOrderSuccess:</strong> Этот тест проверяет успешное создание заказа, когда
                        репозиторий возвращает <code>true</code>.
                    </li>
                    <li><strong>testCreateOrderFailsWhenOrderNotSaved:</strong> Это отрицательный тест, который
                        проверяет, что сервис корректно обрабатывает ситуацию, когда заказ не может быть сохранён.
                    </li>
                </ul>

                <h2>3. Отрицательные тесты</h2>
                <p>Отрицательные тесты необходимы для проверки того, как система реагирует на нештатные или ошибочные
                    ситуации. Рассмотрим сценарий, когда заказ не может быть создан из-за отсутствия пользователя или
                    товаров.</p>

                <h3>Пример теста на несуществующего пользователя:</h3>
                <pre><code>
use PHPUnit\Framework\TestCase;

class OrderServiceTest extends TestCase
{
    private $orderService;
    private $userRepositoryMock;
    private $orderRepositoryMock;

    protected function setUp(): void
    {
        $this->userRepositoryMock = $this->createMock(UserRepositoryInterface::class);
        $this->orderRepositoryMock = $this->createMock(OrderRepositoryInterface::class);

        $this->orderService = new OrderService($this->userRepositoryMock, $this->orderRepositoryMock);
    }

    public function testCreateOrderFailsWhenUserNotFound()
    {
        // Мокируем, что пользователь не найден
        $this->userRepositoryMock
            ->expects($this->once())
            ->method('findById')
            ->willReturn(null);

        // Входные данные для создания заказа
        $request = new CreateOrderRequest(99, [101], '123 Main St');

        // Выполняем сценарий
        $response = $this->orderService->createOrder($request);

        // Проверяем, что создание заказа не удалось
        $this->assertFalse($response->success);
        $this->assertEquals('Пользователь не найден', $response->message);
    }
}
    </code></pre>

                <h3>Объяснение теста:</h3>
                <ul>
                    <li>Мы тестируем случай, когда пользователь не найден в репозитории.</li>
                    <li>Сервис корректно реагирует на ошибку, возвращая соответствующее сообщение.</li>
                    <li>Отрицательные тесты помогают убедиться, что система правильно обрабатывает ошибки.</li>
                </ul>

                <h2>4. Покрытие Тестами</h2>
                <p>Покрытие тестами позволяет измерить процент кода, проверенного тестами. Это помогает выявить области
                    системы, которые не покрыты тестами, и убедиться в надёжности приложения.</p>

                <h3>Команда для запуска тестов с покрытием:</h3>
                <pre><code>
phpunit --coverage-html coverage/
    </code></pre>

                <h3>Советы по улучшению покрытия тестами:</h3>
                <ul>
                    <li>Используйте моки для изоляции тестируемых компонентов и не тестируйте интеграцию в юнит-тестах
                    <li>Тестируйте все важные части бизнес-логики. Покрывайте критические моменты, такие как создание,
                        изменение и удаление данных.
                    </li>
                    <li>Пишите тесты для граничных случаев (например, тестирование нулевых значений или пустых
                        данных).
                    </li>
                    <li>Избегайте излишне сложных тестов. Каждый тест должен быть простым и проверять только одну часть
                        функционала.
                    </li>
                </ul>

                <h2>Заключение</h2>
                <p>Тестирование помогает убедиться, что приложение работает корректно и остаётся стабильным при внесении
                    изменений. Используйте PHPUnit для написания юнит-тестов, создавайте интеграционные тесты для
                    проверки взаимодействия между компонентами и следите за уровнем покрытия кода тестами. Это
                    гарантирует, что ваше приложение будет надёжным и готовым к изменениям.</p>
            </div>
        </div>
    </div>

    <a href="index.html" class="btn btn-back mt-4">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left"
             viewBox="0 0 16 16">
            <path fill-rule="evenodd"
                  d="M15 8a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 0 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 7.5H14.5A.5.5 0 0 1 15 8z"/>
        </svg>
        Назад к манифесту
    </a>
</div>

    <script src="./scripts/bootstrap.bundle.min.js"></script>
</body>
</html>